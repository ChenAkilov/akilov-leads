<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>AKILOV Test</title>
<style>body{font-family:sans-serif;margin:20px} code{background:#eee;padding:2px 6px;border-radius:6px}</style>
</head>
<body>
<h3>AKILOV – Places Quick Test</h3>
<p>נבדוק שהמפתח עובד דרך Maps JavaScript (הספרייה הנכונה). אם יש בעיה, תופיע כאן הודעה ברורה.</p>
<div id="out">טוען ספרייה...</div>
<script>
const out = document.getElementById('out');
const params = new URLSearchParams(location.search);
const key = params.get('key');
if(!key){ out.textContent = 'חסר key ב-URL. פתח עם ?key=YOUR_KEY'; }

function show(msg){ out.textContent = (typeof msg==='string'? msg : JSON.stringify(msg)); console.log(msg); }

function load(src){ return new Promise((res,rej)=>{ const s=document.createElement('script'); s.src=src; s.async=true; s.onload=res; s.onerror=()=>rej(new Error('load fail')); document.head.appendChild(s); }); }

(async ()=>{
  if(!key) return;
  try{
    await load(`https://maps.googleapis.com/maps/api/js?key=${encodeURIComponent(key)}&libraries=places`);
    if(!window.google || !google.maps || !google.maps.places){ show('Google Maps לא נטען. בדוק: Billing מחובר + Places API ו-Maps JS API פעילים + referrer https://chenakilov.github.io/*'); return; }
    show('הספרייה עלתה. מבצע חיפוש...');
    const svc = new google.maps.places.PlacesService(document.createElement('div'));
    const query = 'home decor store in New York, USA';
    svc.textSearch({ query }, (results, status)=>{
      if(status===google.maps.places.PlacesServiceStatus.OK){
        show('עובד ✅ נמצאו: '+(results?.length||0)+' תוצאות');
      } else if(status===google.maps.places.PlacesServiceStatus.ZERO_RESULTS){
        show('עובד ✅ אבל בלי תוצאות (ZERO_RESULTS). נסה עיר אחרת.');
      } else {
        show('שגיאת Places: '+status+' — בדרך כלל זה API לא מופעל / Billing / Referrer / API restrictions');
      }
    });
  }catch(e){
    show('שגיאת טעינה: '+(e.message||e));
  }
})();
</script>
</body>
</html>
