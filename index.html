<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>AKILOV Leads – Live Search</title>
<style>
:root{--bg:#0b1220;--card:#0f172a;--muted:#94a3b8;--border:#1f2937;--accent:#0ea5a6}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:#e5e7eb;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto}
.container{max-width:1100px;margin:0 auto;padding:24px}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;margin-bottom:12px}
h2{margin:0 0 8px 0}
.small{font-size:12px;color:var(--muted)}
.input{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#0b1220;color:#e5e7eb}
.select{appearance:none}
.btn{padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:#111827;color:#e5e7eb;cursor:pointer}
.btn.primary{background:var(--accent);color:#062a2d;border-color:transparent;font-weight:600}
.grid{display:grid;gap:8px}
.grid-3{grid-template-columns:2fr 2fr 140px}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:10px;border-bottom:1px solid var(--border);text-align:left}
.badge{padding:4px 8px;border-radius:999px;background:#12233b;color:#93c5fd;font-size:12px;border:1px solid #1f3455}
.pill{border:1px solid #1f2937;border-radius:999px;padding:4px 10px}
.range{accent-color:#0ea5a6}
</style>
</head>
<body>
<div class="container">
  <!-- API KEY -->
  <div class="card">
    <h3>Google API Key</h3>
    <div class="grid" style="grid-template-columns:1fr 140px">
      <input class="input" id="apiKeyInput" placeholder="Paste your key (starts with AIza...)">
      <button class="btn primary" id="saveKey">Save key</button>
    </div>
    <div class="small" style="margin-top:6px">
      נשמר מקומית אצלך (localStorage). מומלץ להגביל referrer ל: <code>https://chenakilov.github.io/*</code>
    </div>
  </div>

  <!-- SEARCH PANEL -->
  <div class="card">
    <h2>Live Search – Retailers / Wholesalers</h2>
    <div class="grid grid-3" style="margin-top:8px">
      <select class="input select" id="category">
        <optgroup label="Home & Furniture">
          <option>home decor store</option>
          <option>furniture store</option>
          <option>lighting store</option>
          <option>art gallery</option>
          <option>wallpaper store</option>
        </optgroup>
        <optgroup label="Kitchen & Tabletop">
          <option>housewares store</option>
          <option>kitchen supply store</option>
          <option>tableware store</option>
          <option>cookware store</option>
          <option>kitchen accessories</option>
        </optgroup>
        <optgroup label="Gifts & Lifestyle">
          <option>gift shop</option>
          <option>lifestyle store</option>
          <option>flower shop</option>
          <option>concept store</option>
          <option>department store home</option>
        </optgroup>
        <optgroup label="Wholesalers & Distributors">
          <option>home decor wholesaler</option>
          <option>gift wholesaler</option>
          <option>furniture distributor</option>
          <option>general merchandise wholesaler</option>
          <option>buying office</option>
        </optgroup>
        <optgroup label="Designers & Trade">
          <option>interior design studio</option>
          <option>interior designer</option>
          <option>home staging company</option>
          <option>architecture firm</option>
          <option>showroom</option>
        </optgroup>
      </select>

      <select class="input select" id="region">
        <optgroup label="USA">
          <option>New York, USA</option><option>Los Angeles, USA</option><option>Miami, USA</option>
          <option>Chicago, USA</option><option>Dallas, USA</option><option>San Francisco, USA</option>
          <option>Houston, USA</option><option>Seattle, USA</option><option>Atlanta, USA</option><option>Boston, USA</option>
        </optgroup>
        <optgroup label="Europe">
          <option>London, UK</option><option>Paris, France</option><option>Berlin, Germany</option>
          <option>Milan, Italy</option><option>Amsterdam, Netherlands</option><option>Stockholm, Sweden</option>
          <option>Madrid, Spain</option><option>Barcelona, Spain</option><option>Zurich, Switzerland</option>
          <option>Vienna, Austria</option><option>Copenhagen, Denmark</option>
        </optgroup>
        <optgroup label="Canada & LATAM">
          <option>Toronto, Canada</option><option>Vancouver, Canada</option><option>Montreal, Canada</option>
          <option>Mexico City, Mexico</option><option>São Paulo, Brazil</option>
        </optgroup>
        <optgroup label="Middle East">
          <option>Tel Aviv, Israel</option><option>Dubai, UAE</option><option>Riyadh, Saudi Arabia</option>
        </optgroup>
        <optgroup label="Asia">
          <option>Tokyo, Japan</option><option>Seoul, South Korea</option><option>Singapore, Singapore</option>
          <option>Hong Kong</option><option>Bangkok, Thailand</option>
        </optgroup>
        <optgroup label="Australia">
          <option>Sydney, Australia</option><option>Melbourne, Australia</option>
        </optgroup>
      </select>

      <button class="btn primary" id="run">Live Search</button>
    </div>

    <!-- Filters -->
    <div class="row" style="margin-top:10px">
      <label class="row small" style="gap:6px">
        <input type="checkbox" id="hideBrands" checked>
        Hide brand/D2C names
      </label>
      <span class="pill small">Min Rating: <span id="ratingVal">4.0</span> ★</span>
      <input type="range" id="minRating" class="range" min="3.0" max="5.0" step="0.1" value="4.0" style="width:220px">
      <span class="small" id="counts"></span>
    </div>
  </div>

  <!-- RESULTS -->
  <div class="card">
    <table class="table">
      <thead><tr><th>Name</th><th>Location</th><th>Rating (★)</th><th>Categories</th></tr></thead>
      <tbody id="tbody"></tbody>
    </table>
    <div id="status" class="small" style="margin-top:8px"></div>
  </div>
</div>

<script>
/* ---------- Utils ---------- */
function $(s){ return document.querySelector(s) }
function loadScript(src){
  return new Promise((resolve,reject)=>{
    const s=document.createElement('script'); s.src=src; s.async=true;
    s.onload=resolve; s.onerror=()=>reject(new Error('Failed to load Google Maps JS'));
    document.head.appendChild(s);
  });
}
function show(msg){ const s=$('#status'); console.log(msg); s.textContent = typeof msg==='string'? msg : JSON.stringify(msg) }

/* ---------- Brand filtering rules ---------- */
const KEEP_TYPES = new Set([
  'store','home_goods_store','furniture_store','department_store','shopping_mall',
  'hardware_store','lighting_store','supermarket','wholesaler','distributor'
]);
const BLOCK_TYPES = new Set(['manufacturer','corporate_office','headquarters','factory']);
const BRAND_KEYWORDS = ['official','brand','atelier','factory','manufacturer','headquarters','hq','®','™','global brand','the brand'];

function looksLikeBrand(name, types){
  const n=(name||'').toLowerCase();
  if((types||[]).some(t=> BLOCK_TYPES.has(t))) return true;
  return BRAND_KEYWORDS.some(k=> n.includes(k));
}
function looksLikeRetailOrWholesale(types){
  const t=types||[];
  return t.some(x=> KEEP_TYPES.has(x)) || t.includes('point_of_interest') || t.includes('establishment');
}

/* ---------- App ---------- */
let places, gKey=null, lastRaw=[];
const saved = localStorage.getItem('gplaces_key'); if(saved){ $('#apiKeyInput').value = saved; gKey=saved; }
$('#saveKey').onclick = ()=>{ const k=$('#apiKeyInput').value.trim(); if(!k){ alert('Paste a key first'); return } localStorage.setItem('gplaces_key',k); gKey=k; show('Key saved. Now click Live Search.') }
$('#minRating').oninput = ()=>{ $('#ratingVal').textContent = parseFloat($('#minRating').value).toFixed(1); render(lastRaw) }

async function ensureLib(){
  if(!gKey){ show('Please save your API key above.'); return false }
  if(!window.google || !window.google.maps){
    try{ await loadScript(`https://maps.googleapis.com/maps/api/js?key=${encodeURIComponent(gKey)}&libraries=places`) }
    catch(e){ show('Load error: '+(e.message||e)); return false }
  }
  if(!window.google || !google.maps || !google.maps.places){ show('Google Maps failed to load (check referrers/billing/APIs).'); return false }
  places = new google.maps.places.PlacesService(document.createElement('div'));
  return true;
}

function render(raw){
  const hideBrands = $('#hideBrands').checked;
  const minRating = parseFloat($('#minRating').value) || 0;
  const tbody = $('#tbody'); tbody.innerHTML='';
  const filtered = (raw||[]).filter(it=>{
    const types = it.types||[];
    if(!looksLikeRetailOrWholesale(types)) return false;
    if(hideBrands && looksLikeBrand(it.name, types)) return false;
    const rating = typeof it.rating==='number' ? it.rating : 0;
    return rating >= minRating;
  });
  const items = filtered.slice(0,50).map(it=>({
    name: it.name,
    address: it.formatted_address || '',
    rating: (typeof it.rating==='number') ? it.rating.toFixed(1) : '—',
    categories: (it.types||[]).slice(0,3)
  }));
  for(const it of items){
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${it.name}</td><td class="small">${it.address}</td><td><span class="badge">${it.rating} ★</span></td><td class="small">${it.categories.join(', ')}</td>`;
    tbody.appendChild(tr);
  }
  $('#counts').textContent = `Showing ${items.length} / ${raw?.length||0}`;
  show(items.length? 'Done.' : 'No results after filters');
}

document.getElementById('run').onclick = async ()=>{
  const ok = await ensureLib(); if(!ok) return;
  const category = $('#category').value;
  const region = $('#region').value;
  const query = `${category} in ${region}`;
  show('Loading...');
  places.textSearch({ query }, (results, status)=>{
    if(status !== google.maps.places.PlacesServiceStatus.OK && status !== google.maps.places.PlacesServiceStatus.ZERO_RESULTS){
      show('Places error: '+status); lastRaw=[]; render([]); return;
    }
    lastRaw = results||[];
    render(lastRaw);
  });
};
</script>
</body>
</html>
