<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>AKILOV Leads Platform – Live Search</title>
<style>
:root{--bg:#0b1220;--card:#0f172a;--muted:#94a3b8;--border:#1f2937;--accent:#0ea5a6}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:#e5e7eb;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto}
.container{max-width:1100px;margin:0 auto;padding:24px}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px}
.input{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#0b1220;color:#e5e7eb}
.btn{padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:#111827;color:#e5e7eb;cursor:pointer}
.btn.primary{background:var(--accent);color:#062a2d;border-color:transparent;font-weight:600}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:10px;border-bottom:1px solid var(--border);text-align:left}
.badge{padding:4px 8px;border-radius:999px;background:#12233b;color:#93c5fd;font-size:12px;border:1px solid #1f3455}
.small{font-size:12px;color:var(--muted)}
h2{margin:0 0 8px 0}
.grid{display:grid;gap:8px}
.grid-3{grid-template-columns:2fr 2fr 140px}
.select{appearance:none}
.pill{border:1px solid #1f2937;border-radius:999px;padding:4px 10px;margin-right:6px}
.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.brand{display:flex;align-items:center;gap:10px}
.brand .logo{width:28px;height:28px;border-radius:7px;background:linear-gradient(135deg,#e5e7eb,#94a3b8);color:#0b1220;display:grid;place-items:center;font-weight:800}
.help{color:#93c5fd;text-decoration:none}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="brand"><div class="logo">A</div><div><b>AKILOV Leads Platform</b><div class="small">Live retailer/wholesaler finder</div></div></div>
    <a class="help small" href="#" id="keyStatus">Add ?key=YOUR_GOOGLE_API_KEY</a>
  </div>
  <div class="card">
    <h2>Live Search – Retailers / Wholesalers</h2>
    <p class="small">Powered by Google Places (client-side). Your API key stays on your domain (lock it by HTTP referrer in Google Cloud).</p>
    <div class="grid grid-3" style="margin-top:8px">
      <select class="input select" id="category">
        <option>home decor store</option>
        <option>housewares store</option>
        <option>furniture store</option>
        <option>interior design studio</option>
        <option>wholesaler home decor</option>
        <option>distributor home decor</option>
        <option>buying office</option>
      </select>
      <select class="input select" id="region">
        <optgroup label="USA">
          <option>New York, USA</option>
          <option>Los Angeles, USA</option>
          <option>Miami, USA</option>
          <option>Chicago, USA</option>
          <option>Dallas, USA</option>
        </optgroup>
        <optgroup label="EU">
          <option>London, UK</option>
          <option>Paris, France</option>
          <option>Berlin, Germany</option>
          <option>Milan, Italy</option>
          <option>Amsterdam, Netherlands</option>
          <option>Stockholm, Sweden</option>
          <option>Madrid, Spain</option>
        </optgroup>
      </select>
      <button class="btn primary" id="run">Live Search</button>
    </div>
    <div class="small" style="margin-top:6px">Preset: Wall Clocks • Vases • Candle Holders • Scented Candles • Centerpieces • Trays & Bowls • Premium Kitchen • Tabletop Decor</div>
  </div>
  <div class="card" style="margin-top:12px">
    <table class="table">
      <thead><tr><th>Name</th><th>Location</th><th>Score</th><th>Categories</th></tr></thead>
      <tbody id="tbody"></tbody>
    </table>
    <div id="status" class="small" style="margin-top:8px"></div>
  </div>
</div>

<script>
const qs = new URLSearchParams(location.search)
const apiKey = qs.get('key')
const keyStatus = document.getElementById('keyStatus')
if(apiKey){
  keyStatus.textContent = 'API key ✓'
  keyStatus.href = 'https://console.cloud.google.com/google/maps-apis/credentials'
}else{
  keyStatus.textContent = 'Add ?key=YOUR_GOOGLE_API_KEY'
  keyStatus.href = 'https://console.cloud.google.com/google/maps-apis/credentials'
}

function loadScript(src){
  return new Promise((resolve,reject)=>{
    const s = document.createElement('script'); s.src = src; s.async = true
    s.onload = resolve; s.onerror = ()=>reject(new Error('Failed to load Google Maps JS'))
    document.head.appendChild(s)
  })
}

let places
async function init(){
  if(!apiKey){
    document.getElementById('status').textContent = 'Missing API key. Add ?key=YOUR_GOOGLE_API_KEY to the URL.'
    return
  }
  await loadScript(`https://maps.googleapis.com/maps/api/js?key=${encodeURIComponent(apiKey)}&libraries=places`)
  places = new google.maps.places.PlacesService(document.createElement('div'))
  document.getElementById('run').onclick = runSearch
  document.getElementById('status').textContent = 'Ready. Choose category & region and click Live Search.'
}
async function runSearch(){
  const category = document.getElementById('category').value
  const region = document.getElementById('region').value
  const query = `${category} in ${region}`
  const tbody = document.getElementById('tbody')
  const status = document.getElementById('status')
  tbody.innerHTML = ''; status.textContent = 'Loading...'
  const req = { query, type: ['store'] }
  places.textSearch(req, (results, st, pagination)=>{
    if(st !== google.maps.places.PlacesServiceStatus.OK && st !== google.maps.places.PlacesServiceStatus.ZERO_RESULTS){
      status.textContent = 'Error: ' + st; return
    }
    const items = (results||[]).slice(0,25).map(it => ({
      name: it.name,
      address: it.formatted_address || '',
      city: (it.formatted_address||'').split(',')[0] || '',
      country: (it.formatted_address||'').split(',').pop()?.trim() || '',
      score: Math.min(99, Math.max(60, Math.round(((it.rating||4.2)*20)))),
      categories: (it.types||[]).slice(0,3)
    }))
    for(const it of items){
      const tr = document.createElement('tr')
      tr.innerHTML = `<td>${it.name}</td><td class="small">${it.city}, ${it.country}</td><td><span class="badge">${it.score}</span></td><td class="small">${it.categories.join(', ')}</td>`
      tbody.appendChild(tr)
    }
    status.textContent = items.length ? `Loaded ${items.length} results for “${query}”` : 'No results'
  })
}
init()
</script>
</body>
</html>
